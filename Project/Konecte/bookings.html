<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
  <link rel="stylesheet" href="./src/css/konecte.css">
  <title>Book Event - Konekté</title>
</head>

<body>
  <!-- Navbar -->
  <nav class="fixed-top">
    <div class="website-mockup">
      <div class="header">
        <div class="logo"><a href="index.html">Konekté</a></div>
        <nav class="nav">
          <a href="events.html">Browse Events</a>
          <a href="create.html">Create Event</a>
          <a href="#">Bookings</a>
          <a href="login.html">Login</a>
        </nav>
        <div class="hamburger" onclick="toggleMobileMenu()">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
      <div class="mobile-nav" id="mobileNav">
        <a href="events.html">Browse Events</a>
        <a href="create.html">Create Event</a>
        <a href="bookings.html">Bookings</a>
        <a href="login.html">Login</a>
      </div>
    </div>
  </nav>

  <div class="booking-container">
    <a href="events.html" class="back-link">← Back to Events</a>

    <div class="booking-card">
      <h1 class="event-title" id="eventTitle">Loading Event...</h1>
      <div class="event-meta" id="eventMeta"></div>

      <form id="bookingForm">
        <!-- Tickets -->
        <div class="form-section">
          <h3 class="booking-section-title">Select Tickets</h3>
          <div id="ticketOptions"></div>
        </div>

        <!-- Personal Info -->
        <div class="form-section">
          <h3 class="booking-section-title">Your Details</h3>
          <input type="text" class="form-control" id="firstName" placeholder="First Name" required>
          <input type="text" class="form-control" id="lastName" placeholder="Last Name" required>
          <input type="email" class="form-control" id="email" placeholder="Email Address" required>
          <input type="tel" class="form-control" id="phone" placeholder="Phone Number (Optional)">
        </div>

        <!-- Total -->
        <div class="total-section">
          <div class="total-row">
            <span>Subtotal:</span>
            <span id="subtotal">$0.00</span>
          </div>
          <div class="total-row">
            <span>Service Fee:</span>
            <span id="serviceFee">$0.00</span>
          </div>
          <div class="total-row total-final">
            <span>Total:</span>
            <span id="totalAmount">$0.00</span>
          </div>
        </div>

        <button type="submit" class="book-btn">Book Now</button>
      </form>
    </div>
  </div>

  <script>
    const eventData = {
      'comic-con': {
        title: 'Comic Con 2025',
        date: 'March 15-17, 2025',
        location: 'Convention Center',
        tickets: [
          { name: 'General Admission', price: 45, description: 'Access to exhibition hall and basic panels' },
          { name: 'VIP Pass', price: 125, description: 'All access including exclusive panels and VIP lounge' },
          { name: 'Weekend Pass', price: 99, description: 'Full weekend access to all general activities' }
        ]
      },
      'developer-conference': {
        title: 'Developer Conference',
        date: 'April 22-23, 2025',
        location: 'Tech Hub Auditorium',
        tickets: [
          { name: 'Standard Ticket', price: 199, description: 'Access to all talks and networking sessions' },
          { name: 'Premium Pass', price: 299, description: 'Standard access plus workshops and premium meals' },
          { name: 'Student Discount', price: 99, description: 'Special pricing for students with valid ID' }
        ]
      },
      'anyma-concert': {
        title: 'Anyma Concert',
        date: 'May 10, 2025',
        location: 'Music Arena',
        tickets: [
          { name: 'General Admission', price: 75, description: 'Standing area with great sound' },
          { name: 'VIP Experience', price: 150, description: 'Premium viewing area with drinks' },
          { name: 'Meet & Greet', price: 250, description: 'VIP experience plus meet and greet' }
        ]
      },
      'adoption-day': {
        title: 'Pet Adoption Day',
        date: 'June 5, 2025',
        location: 'City Park',
        tickets: [
          { name: 'Entry Fee', price: 10, description: 'Entry to adoption fair with refreshments' },
          { name: 'Family Pass', price: 25, description: 'Entry for up to 4 family members plus activity pack' }
        ]
      },
      'art-exhibition': {
        title: 'Contemporary Art Exhibition',
        date: 'July 12-25, 2025',
        location: 'Modern Art Gallery',
        tickets: [
          { name: 'Regular Entry', price: 20, description: 'Self-guided tour of all exhibition areas' },
          { name: 'Guided Tour', price: 35, description: 'Expert-led tour with detailed insights' },
          { name: 'Opening Night', price: 65, description: 'Exclusive opening night with artist meet & greets' }
        ]
      },
      'gaming-tournament': {
        title: 'Gaming Tournament',
        date: 'August 18-20, 2025',
        location: 'Gaming Center',
        tickets: [
          { name: 'Spectator Pass', price: 25, description: 'Watch all tournaments with food court access' },
          { name: 'Player Registration', price: 50, description: 'Compete in tournaments with spectator access' },
          { name: 'Premium Package', price: 85, description: 'Player registration plus merchandise and priority seating' }
        ]
      }
    };

    let quantities = {};

    function getEventFromURL() {
      const params = new URLSearchParams(window.location.search);
      const eventParam = params.get('event');
      console.log('Event parameter from URL:', eventParam); // Debug line
      return eventParam || 'comic-con';
    }

    function initializePage() {
      const eventKey = getEventFromURL();
      console.log('Loading event:', eventKey); // Debug line
      const event = eventData[eventKey];
      
      if (!event) {
        document.getElementById('eventTitle').textContent = 'Event Not Found';
        console.log('Event not found for key:', eventKey);
        return;
      }

      document.getElementById('eventTitle').textContent = event.title;
      document.getElementById('eventMeta').textContent = `${event.date} • ${event.location}`;
      document.title = `Book ${event.title} - Konekté`;

      createTicketOptions(event.tickets);
    }

    function createTicketOptions(tickets) {
      const container = document.getElementById('ticketOptions');
      container.innerHTML = '';

      tickets.forEach((ticket, index) => {
        const ticketDiv = document.createElement('div');
        ticketDiv.className = 'ticket-option';
        ticketDiv.dataset.ticketIndex = index;
        ticketDiv.dataset.price = ticket.price;
        
        ticketDiv.innerHTML = `
          <div class="ticket-header">
            <div class="ticket-name">${ticket.name}</div>
            <div class="ticket-price">$${ticket.price}</div>
          </div>
          <div class="ticket-description">${ticket.description}</div>
          <div class="quantity-controls">
            <div class="qty-btn" onclick="changeQuantity(${index}, -1)">-</div>
            <div class="qty-display" id="qty-${index}">0</div>
            <div class="qty-btn" onclick="changeQuantity(${index}, 1)">+</div>
          </div>
        `;

        container.appendChild(ticketDiv);
      });
    }

    function changeQuantity(ticketIndex, change) {
      if (!quantities[ticketIndex]) quantities[ticketIndex] = 0;
      
      quantities[ticketIndex] = Math.max(0, quantities[ticketIndex] + change);
      document.getElementById(`qty-${ticketIndex}`).textContent = quantities[ticketIndex];
      
      const ticketOption = document.querySelector(`[data-ticket-index="${ticketIndex}"]`);
      if (quantities[ticketIndex] > 0) {
        ticketOption.classList.add('selected');
      } else {
        ticketOption.classList.remove('selected');
      }

      calculateTotal();
    }

    function calculateTotal() {
      let subtotal = 0;
      
      Object.keys(quantities).forEach(ticketIndex => {
        const quantity = quantities[ticketIndex];
        const price = parseFloat(document.querySelector(`[data-ticket-index="${ticketIndex}"]`).dataset.price);
        subtotal += quantity * price;
      });

      const serviceFee = subtotal * 0.1;
      const total = subtotal + serviceFee;

      document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
      document.getElementById('serviceFee').textContent = `$${serviceFee.toFixed(2)}`;
      document.getElementById('totalAmount').textContent = `$${total.toFixed(2)}`;
    }

    document.getElementById('bookingForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const hasTickets = Object.values(quantities).some(qty => qty > 0);
      if (!hasTickets) {
        alert('Please select at least one ticket.');
        return;
      }

      const bookBtn = document.querySelector('.book-btn');
      bookBtn.textContent = 'Processing...';
      bookBtn.disabled = true;

      setTimeout(() => {
        alert(`Booking confirmed! Details sent to ${document.getElementById('email').value}`);
        window.location.href = 'events.html';
      }, 1500);
    });

    function toggleMobileMenu() {
      const mobileNav = document.getElementById('mobileNav');
      mobileNav.classList.toggle('active');
    }

    document.addEventListener('DOMContentLoaded', initializePage);
  </script>
  <script src="./src/js/script.js"></script>
</body>
</html>